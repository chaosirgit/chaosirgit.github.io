<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=color-scheme content="light dark">
<meta name=author content="Ethan Kuo">
<meta name=description content="ElasticSearch Problems and Usage    The solution of index.max_result_window error    1  curl -XPUT &#34;http://localhost:9200/my_index/_settings&#34; -d '{ &#34;index&#34; : { &#34;max_result_window&#34; : 100000000 } }'   Search Package    1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57  public static function SearchAccountLogEs($must = array(),$must_not = array(),$should = array(),$aggs = array(),$size = 10,$page = 1,$sort = array(),$debug = false){ $index = Config::get('elasticsearch.">
<meta name=keywords content="phper,goer,php,golang,php/go">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Laravel ElasticSearch Plugin">
<meta name=twitter:description content="ElasticSearch Problems and Usage    The solution of index.max_result_window error    1  curl -XPUT &#34;http://localhost:9200/my_index/_settings&#34; -d '{ &#34;index&#34; : { &#34;max_result_window&#34; : 100000000 } }'   Search Package    1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57  public static function SearchAccountLogEs($must = array(),$must_not = array(),$should = array(),$aggs = array(),$size = 10,$page = 1,$sort = array(),$debug = false){ $index = Config::get('elasticsearch.">
<meta property="og:title" content="Laravel ElasticSearch Plugin">
<meta property="og:description" content="ElasticSearch Problems and Usage    The solution of index.max_result_window error    1  curl -XPUT &#34;http://localhost:9200/my_index/_settings&#34; -d '{ &#34;index&#34; : { &#34;max_result_window&#34; : 100000000 } }'   Search Package    1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57  public static function SearchAccountLogEs($must = array(),$must_not = array(),$should = array(),$aggs = array(),$size = 10,$page = 1,$sort = array(),$debug = false){ $index = Config::get('elasticsearch.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.adminchao.com/posts/laravel-elasticsearch-plugin/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2018-06-08T12:43:00+00:00">
<meta property="article:modified_time" content="2018-06-08T12:43:00+00:00">
<title>
Laravel ElasticSearch Plugin Â· Ethan Kuo Blog
</title>
<link rel=canonical href=https://blog.adminchao.com/posts/laravel-elasticsearch-plugin/>
<link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin>
<link rel=stylesheet href=/css/coder.min.d9fddbffe6f27e69985dc5fe0471cdb0e57fbf4775714bc3d847accb08f4a1f6.css integrity="sha256-2f3b/+byfmmYXcX+BHHNsOV/v0d1cUvD2Eesywj0ofY=" crossorigin=anonymous media=screen>
<link rel=stylesheet href=/css/coder-dark.min.002ee2378e14c7a68f1f0a53d9694ed252090987c4e768023fac694a4fc5f793.css integrity="sha256-AC7iN44Ux6aPHwpT2WlO0lIJCYfE52gCP6xpSk/F95M=" crossorigin=anonymous media=screen>
<link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16>
<link rel=apple-touch-icon href=/images/apple-touch-icon.png>
<link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png>
<meta name=generator content="Hugo 0.89.1">
</head>
<body class="preload-transitions colorscheme-dark">
<div class=float-container>
<a id=dark-mode-toggle class=colorscheme-toggle>
<i class="fa fa-adjust fa-fw" aria-hidden=true></i>
</a>
</div>
<main class=wrapper>
<nav class=navigation>
<section class=container>
<a class=navigation-title href=/>
Ethan Kuo Blog
</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle>
<i class="fa fa-bars fa-fw" aria-hidden=true></i>
</label>
<ul class=navigation-list>
<li class=navigation-item>
<a class=navigation-link href=/about/>About</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/posts/>Blog</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/contact/>Contact me</a>
</li>
<li class="navigation-item menu-separator">
<span>|</span>
</li>
<li class=navigation-item>
<a href=https://blog.adminchao.com/zh-cn/>ðŸ‡¨ðŸ‡³</a>
</li>
</ul>
</section>
</nav>
<div class=content>
<section class="container post">
<article>
<header>
<div class=post-title>
<h1 class=title>
<a class=title-link href=https://blog.adminchao.com/posts/laravel-elasticsearch-plugin/>
Laravel ElasticSearch Plugin
</a>
</h1>
</div>
<div class=post-meta>
<div class=date>
<span class=posted-on>
<i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2018-06-08T12:43:00Z>
2018-06-08 12:43:00
</time>
</span>
<span class=reading-time>
<i class="fa fa-clock-o" aria-hidden=true></i>
2-minute read
</span>
</div>
<div class=categories>
<i class="fa fa-folder" aria-hidden=true></i>
<a href=/categories/laravel/>Laravel</a></div>
<div class=tags>
<i class="fa fa-tag" aria-hidden=true></i>
<span class=tag>
<a href=/tags/laravel/>Laravel</a>
</span>
<span class=separator>â€¢</span>
<span class=tag>
<a href=/tags/php/>PHP</a>
</span>
<span class=separator>â€¢</span>
<span class=tag>
<a href=/tags/elasticsearch/>ElasticSearch</a>
</span></div>
</div>
</header>
<div>
<h2 id=elasticsearch-problems-and-usage>
ElasticSearch Problems and Usage
<a class=heading-link href=#elasticsearch-problems-and-usage>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<h3 id=the-solution-of-indexmax_result_window-error>
The solution of index.max_result_window error
<a class=heading-link href=#the-solution-of-indexmax_result_window-error>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h3>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>curl -XPUT <span style=color:#f1fa8c>&#34;http://localhost:9200/my_index/_settings&#34;</span> -d <span style=color:#f1fa8c>&#39;{ &#34;index&#34; : { &#34;max_result_window&#34; : 100000000 } }&#39;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id=search-package>
Search Package
<a class=heading-link href=#search-package>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h3>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#ff79c6>public</span> <span style=color:#ff79c6>static</span> <span style=color:#ff79c6>function</span> <span style=color:#50fa7b>SearchAccountLogEs</span>(<span style=color:#8be9fd;font-style:italic>$must</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>array</span>(),<span style=color:#8be9fd;font-style:italic>$must_not</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>array</span>(),<span style=color:#8be9fd;font-style:italic>$should</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>array</span>(),<span style=color:#8be9fd;font-style:italic>$aggs</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>array</span>(),<span style=color:#8be9fd;font-style:italic>$size</span> <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>10</span>,<span style=color:#8be9fd;font-style:italic>$page</span> <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>,<span style=color:#8be9fd;font-style:italic>$sort</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>array</span>(),<span style=color:#8be9fd;font-style:italic>$debug</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>false</span>){
        <span style=color:#8be9fd;font-style:italic>$index</span> <span style=color:#ff79c6>=</span> Config<span style=color:#ff79c6>::</span><span style=color:#50fa7b>get</span>(<span style=color:#f1fa8c>&#39;elasticsearch.index&#39;</span>);
        <span style=color:#8be9fd;font-style:italic>$type</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;accountlog&#39;</span>;
        <span style=color:#8be9fd;font-style:italic>$must</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$must</span> <span style=color:#ff79c6>??</span> <span style=color:#ff79c6>array</span>();
        <span style=color:#8be9fd;font-style:italic>$must_not</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$must_not</span> <span style=color:#ff79c6>??</span> <span style=color:#ff79c6>array</span>();
        <span style=color:#8be9fd;font-style:italic>$should</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$should</span> <span style=color:#ff79c6>??</span> <span style=color:#ff79c6>array</span>();
        <span style=color:#8be9fd;font-style:italic>$aggs</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$aggs</span> <span style=color:#ff79c6>??</span> <span style=color:#ff79c6>array</span>();
        <span style=color:#8be9fd;font-style:italic>$sort</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$sort</span> <span style=color:#ff79c6>??</span> <span style=color:#ff79c6>array</span>();
        <span style=color:#8be9fd;font-style:italic>$from</span> <span style=color:#ff79c6>=</span> (<span style=color:#8be9fd;font-style:italic>$page</span> <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>1</span>) <span style=color:#ff79c6>*</span> <span style=color:#8be9fd;font-style:italic>$size</span>;
        <span style=color:#8be9fd;font-style:italic>$params</span> <span style=color:#ff79c6>=</span> [
            <span style=color:#f1fa8c>&#39;index&#39;</span><span style=color:#ff79c6>=&gt;</span><span style=color:#8be9fd;font-style:italic>$index</span>,
            <span style=color:#f1fa8c>&#39;type&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$type</span>,
            <span style=color:#f1fa8c>&#39;body&#39;</span><span style=color:#ff79c6>=&gt;</span>[
                <span style=color:#f1fa8c>&#39;query&#39;</span><span style=color:#ff79c6>=&gt;</span>[
                    <span style=color:#f1fa8c>&#39;bool&#39;</span><span style=color:#ff79c6>=&gt;</span>[
                        <span style=color:#f1fa8c>&#39;must&#39;</span><span style=color:#ff79c6>=&gt;</span><span style=color:#8be9fd;font-style:italic>$must</span>,
                        <span style=color:#f1fa8c>&#39;must_not&#39;</span><span style=color:#ff79c6>=&gt;</span><span style=color:#8be9fd;font-style:italic>$must_not</span>,
<span style=color:#6272a4>//                        &#39;should&#39; =&gt; $should
</span><span style=color:#6272a4></span>                        ]
                    ]
<span style=color:#6272a4>//                &#39;aggs&#39;=&gt;$aggs,
</span><span style=color:#6272a4></span>                ],
            <span style=color:#f1fa8c>&#39;size&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$size</span>,
            <span style=color:#f1fa8c>&#39;from&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$from</span>
        ];
        
        <span style=color:#8be9fd;font-style:italic>$client</span> <span style=color:#ff79c6>=</span> ClientBuilder<span style=color:#ff79c6>::</span><span style=color:#50fa7b>create</span>()
            <span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>setHosts</span>( Config<span style=color:#ff79c6>::</span><span style=color:#50fa7b>get</span>( <span style=color:#f1fa8c>&#39;elasticsearch.hosts&#39;</span> ) )
            <span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>setRetries</span>( <span style=color:#bd93f9>2</span> )
            <span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>build</span>();
        <span style=color:#ff79c6>if</span>(<span style=color:#ff79c6>!</span><span style=color:#ff79c6>empty</span>(<span style=color:#8be9fd;font-style:italic>$aggs</span>)){
            <span style=color:#8be9fd;font-style:italic>$params</span>[<span style=color:#f1fa8c>&#39;body&#39;</span>][<span style=color:#f1fa8c>&#39;aggs&#39;</span>] <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$aggs</span>;
        }
        <span style=color:#ff79c6>if</span>(<span style=color:#ff79c6>!</span><span style=color:#ff79c6>empty</span>(<span style=color:#8be9fd;font-style:italic>$should</span>)){
            <span style=color:#8be9fd;font-style:italic>$params</span>[<span style=color:#f1fa8c>&#39;body&#39;</span>][<span style=color:#f1fa8c>&#39;query&#39;</span>][<span style=color:#f1fa8c>&#34;bool&#34;</span>][<span style=color:#f1fa8c>&#34;should&#34;</span>] <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$should</span>;
            <span style=color:#8be9fd;font-style:italic>$params</span>[<span style=color:#f1fa8c>&#39;body&#39;</span>][<span style=color:#f1fa8c>&#39;query&#39;</span>][<span style=color:#f1fa8c>&#34;bool&#34;</span>][<span style=color:#f1fa8c>&#34;minimum_should_match&#34;</span>] <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>;
        }
        <span style=color:#ff79c6>if</span>(<span style=color:#ff79c6>!</span><span style=color:#ff79c6>empty</span>(<span style=color:#8be9fd;font-style:italic>$sort</span>)){
            <span style=color:#8be9fd;font-style:italic>$params</span>[<span style=color:#f1fa8c>&#39;body&#39;</span>][<span style=color:#f1fa8c>&#39;sort&#39;</span>] <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>array</span>(<span style=color:#8be9fd;font-style:italic>$sort</span>);
        }
        <span style=color:#ff79c6>if</span>(<span style=color:#8be9fd;font-style:italic>$debug</span> <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>true</span>)
            <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>$params</span>;
        <span style=color:#8be9fd;font-style:italic>$response</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$client</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>search</span>(<span style=color:#8be9fd;font-style:italic>$params</span>);
        <span style=color:#8be9fd;font-style:italic>$results</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>array</span>(
          <span style=color:#f1fa8c>&#39;total&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$response</span>[<span style=color:#f1fa8c>&#39;hits&#39;</span>][<span style=color:#f1fa8c>&#39;total&#39;</span>],
<span style=color:#6272a4>//            key($aggs) =&gt; $response[&#39;aggregations&#39;][key($aggs)][&#39;value&#39;]
</span><span style=color:#6272a4></span>        );
        <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span><span style=color:#ff79c6>empty</span>(<span style=color:#8be9fd;font-style:italic>$aggs</span>)){
            <span style=color:#8be9fd;font-style:italic>$results</span>[key(<span style=color:#8be9fd;font-style:italic>$aggs</span>)] <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$response</span>[<span style=color:#f1fa8c>&#39;aggregations&#39;</span>][key(<span style=color:#8be9fd;font-style:italic>$aggs</span>)][<span style=color:#f1fa8c>&#39;value&#39;</span>];
        }
        <span style=color:#8be9fd;font-style:italic>$results</span>[<span style=color:#f1fa8c>&#39;data&#39;</span>] <span style=color:#ff79c6>=</span> [];
        <span style=color:#ff79c6>foreach</span> (<span style=color:#8be9fd;font-style:italic>$response</span>[<span style=color:#f1fa8c>&#39;hits&#39;</span>][<span style=color:#f1fa8c>&#39;hits&#39;</span>] <span style=color:#ff79c6>as</span> <span style=color:#8be9fd;font-style:italic>$key</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$value</span>){
            <span style=color:#8be9fd;font-style:italic>$results</span>[<span style=color:#f1fa8c>&#39;data&#39;</span>][] <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$value</span>[<span style=color:#f1fa8c>&#39;_source&#39;</span>];
        }

        <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>$results</span>;
    }
</code></pre></td></tr></table>
</div>
</div><h3 id=update-package>
Update Package
<a class=heading-link href=#update-package>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h3>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#ff79c6>public</span> <span style=color:#ff79c6>static</span> <span style=color:#ff79c6>function</span> <span style=color:#50fa7b>updateAccountLogEs</span>(<span style=color:#8be9fd;font-style:italic>$log</span>)
    {
        <span style=color:#8be9fd;font-style:italic>$other</span> <span style=color:#ff79c6>=</span> User<span style=color:#ff79c6>::</span><span style=color:#50fa7b>find</span>(<span style=color:#8be9fd;font-style:italic>$log</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>user_id</span>);
        <span style=color:#6272a4>// Update ES index
</span><span style=color:#6272a4></span>        <span style=color:#8be9fd;font-style:italic>$client</span> <span style=color:#ff79c6>=</span> ClientBuilder<span style=color:#ff79c6>::</span><span style=color:#50fa7b>create</span>()
            <span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>setHosts</span>(Config<span style=color:#ff79c6>::</span><span style=color:#50fa7b>get</span>(<span style=color:#f1fa8c>&#39;elasticsearch.hosts&#39;</span>))
            <span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>setRetries</span>(<span style=color:#bd93f9>2</span>)
            <span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>build</span>();
        <span style=color:#8be9fd;font-style:italic>$index</span> <span style=color:#ff79c6>=</span> Config<span style=color:#ff79c6>::</span><span style=color:#50fa7b>get</span>(<span style=color:#f1fa8c>&#39;elasticsearch.index&#39;</span>);
        <span style=color:#8be9fd;font-style:italic>$type</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;accountlog&#39;</span>;

        <span style=color:#8be9fd;font-style:italic>$params</span> <span style=color:#ff79c6>=</span> [
            <span style=color:#f1fa8c>&#39;index&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$index</span>,
            <span style=color:#f1fa8c>&#39;type&#39;</span>  <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$type</span>,
            <span style=color:#f1fa8c>&#39;id&#39;</span>    <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$log</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>id</span>
        ];

        <span style=color:#ff79c6>try</span> {
            <span style=color:#8be9fd;font-style:italic>$client</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>delete</span>(<span style=color:#8be9fd;font-style:italic>$params</span>);
        }<span style=color:#ff79c6>catch</span> (\Exception <span style=color:#8be9fd;font-style:italic>$ex</span>){}

        <span style=color:#8be9fd;font-style:italic>$params</span> <span style=color:#ff79c6>=</span> [
            <span style=color:#f1fa8c>&#39;index&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$index</span>,
            <span style=color:#f1fa8c>&#39;type&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$type</span>,
            <span style=color:#f1fa8c>&#39;id&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$log</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>id</span>,
            <span style=color:#f1fa8c>&#39;body&#39;</span> <span style=color:#ff79c6>=&gt;</span> [
                <span style=color:#f1fa8c>&#39;id&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$log</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>id</span>,
                <span style=color:#f1fa8c>&#39;user_id&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$log</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>user_id</span>,
                <span style=color:#f1fa8c>&#39;user_money&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$log</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>user_money</span>,
                <span style=color:#f1fa8c>&#39;user_money1&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$log</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>user_money1</span>,
                <span style=color:#f1fa8c>&#39;user_money3&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$log</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>user_money3</span>,
                <span style=color:#f1fa8c>&#39;frozen_money&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$log</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>frozen_money</span>,
                <span style=color:#f1fa8c>&#39;letter_of_credit&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$log</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>letter_of_credit</span>,
                <span style=color:#f1fa8c>&#39;shop_letter_credit&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$log</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>shop_letter_credit</span>,
                <span style=color:#f1fa8c>&#39;rank_points&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$log</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>rank_points</span>,
                <span style=color:#f1fa8c>&#39;pay_points&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$log</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>pay_points</span>,
                <span style=color:#f1fa8c>&#39;created_time&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$log</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>time</span>,
                <span style=color:#f1fa8c>&#39;info&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$log</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>info</span>,
                <span style=color:#f1fa8c>&#39;province_id&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$other</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>province_id</span>,
                <span style=color:#f1fa8c>&#39;city_id&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$other</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>city_id</span>,
                <span style=color:#f1fa8c>&#39;county_id&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$other</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>county_id</span>,
                <span style=color:#f1fa8c>&#39;industry_id&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$other</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>industry_id</span>,
                <span style=color:#f1fa8c>&#39;parent_id&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$other</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>parent_id</span>,
                <span style=color:#f1fa8c>&#39;type&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$log</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>type</span>
            ]
        ];

        <span style=color:#8be9fd;font-style:italic>$client</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>index</span>(<span style=color:#8be9fd;font-style:italic>$params</span>);
    }

</code></pre></td></tr></table>
</div>
</div>
</div>
<footer>
</footer>
</article>
</section>
</div>
<footer class=footer>
<section class=container>
Â©
2019 -
2022
Ethan Kuo
Â·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.
</section>
</footer>
</main>
<script src=/js/coder.min.39a51230dce2ac866c049b52573e38bf60666af4bc63c1bdf203b9b2d95b1cd6.js integrity="sha256-OaUSMNzirIZsBJtSVz44v2BmavS8Y8G98gO5stlbHNY="></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NK08XEDHKZ"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-NK08XEDHKZ')</script>
</body>
</html>