<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Eloquent on 郭超超的博客</title>
    <link>https://blog.adminchao.com/zh-cn/tags/eloquent/</link>
    <description>Recent content in Eloquent on 郭超超的博客</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <lastBuildDate>Thu, 10 Jan 2019 15:29:08 +0000</lastBuildDate><atom:link href="https://blog.adminchao.com/zh-cn/tags/eloquent/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Laravel Eloquent 返回结果优化</title>
      <link>https://blog.adminchao.com/zh-cn/posts/laravel-eloquent-%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%E4%BC%98%E5%8C%96/</link>
      <pubDate>Thu, 10 Jan 2019 15:29:08 +0000</pubDate>
      
      <guid>https://blog.adminchao.com/zh-cn/posts/laravel-eloquent-%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%E4%BC%98%E5%8C%96/</guid>
      <description>前言    我们都知道在模型中使用 appends 属性来构建访问器使得返回结果添加一些字段信息，但是这样的话有一个坏处，就是所有这个模型的返回结果都会有这些字段信息，如果接口中规定了严格的返回信息字段，这样就不合适了。
能不能有好的方法动态的显示或隐藏这些字段信息呢？
答案是肯定的。
动态显示    在接口中临时显示    首先在 Model 中构建访问器    1 2 3  public function getUsernameAttribute(){ return $this-&amp;gt;hasOne(&amp;#39;App\User&amp;#39;,&amp;#39;id&amp;#39;,&amp;#39;user_id&amp;#39;)-&amp;gt;value(&amp;#39;username&amp;#39;); }   Model 不建立 appends 属性    单条记录    1 2 3 4 5  public function getUserInfo(Request $request){ $id = $request-&amp;gt;get(&amp;#39;id&amp;#39;,null); $result = User::find($id)-&amp;gt;append(&amp;#39;username&amp;#39;); return response()-&amp;gt;json($result); }   多条记录    1 2 3 4 5 6 7 8 9 10  public function getUsers(Request $request){ $limit = $request-&amp;gt;get(&amp;#39;limit&amp;#39;,10); $results = User::orderBy(&amp;#39;id&amp;#39;,&amp;#39;desc&amp;#39;) -&amp;gt;paginate($limit) -&amp;gt;transform(function($item,$key){ $item-&amp;gt;append(&amp;#39;username&amp;#39;); return $item; //如果不 return 出去返回的是 null  }); return response()-&amp;gt;json($results); }   如果不想用 append 方法的关联关系可以这样用 或者报 Method items does not exist.</description>
    </item>
    
    <item>
      <title>Laravel Eloquent 高级</title>
      <link>https://blog.adminchao.com/zh-cn/posts/laravel-eloquent-%E9%AB%98%E7%BA%A7/</link>
      <pubDate>Wed, 22 Aug 2018 11:02:10 +0000</pubDate>
      
      <guid>https://blog.adminchao.com/zh-cn/posts/laravel-eloquent-%E9%AB%98%E7%BA%A7/</guid>
      <description>前言    在使用 Laravel Eloquent 模型时，深刻体会到什么是优雅！虽然在业务逻辑中可以使用模型链式调用DB模型的操作方法来解决，但是始终少了优雅！这里专门记录去 DB 模型的操作方法，使代码优雅化。
目标    leftJoin where    目标 SQL    1  select * from user_second left join user on user_second.user_id = user.id where user.status = 1   解决方案    1 2  &amp;lt;?php UserSecond::leftJoin(&amp;#39;user&amp;#39;,&amp;#39;user_second.user_id&amp;#39;,&amp;#39;=&amp;#39;,&amp;#39;user.id&amp;#39;)-&amp;gt;where(&amp;#39;user.status&amp;#39;,1)-&amp;gt;get();   但是这样的缺点在于
 得到的结果两个表的字段如果相同，右表会覆盖左表的值。 得到的结果不能使用模型精确控制。  1 2 3 4 5 6 7 8 9  { &amp;#34;id&amp;#34;: 11, //其实左表也就是`user_second`表的 id 为 9 这里被 `user` 表的 id 覆盖了  &amp;#34;user_id&amp;#34;: 11, //这里是 `user_second` 表的 `user_id`  &amp;#34;enlist_currency&amp;#34;: &amp;#34;256.</description>
    </item>
    
    <item>
      <title>独立使用 Eloquent</title>
      <link>https://blog.adminchao.com/zh-cn/posts/%E7%8B%AC%E7%AB%8B%E4%BD%BF%E7%94%A8-eloquent/</link>
      <pubDate>Wed, 04 Jul 2018 14:14:22 +0000</pubDate>
      
      <guid>https://blog.adminchao.com/zh-cn/posts/%E7%8B%AC%E7%AB%8B%E4%BD%BF%E7%94%A8-eloquent/</guid>
      <description>前言    Laravel 的 Eloquent 是一个很棒的ORM，Eloquent 是独立的模块，我们也可以在自己的项目里通过composer来使用Eloquent，本文就详细讲解如何在自己的项目集成 Eloquent。
安装    在项目目录下执行
1  composer require illuminate/database:^5.0   或直接在 composer.json 文件里添加:
1 2 3 4 5 6 7 8 9 10 11 12  { &amp;#34;require&amp;#34;: { &amp;#34;illuminate/database&amp;#34;: &amp;#34;^5.0&amp;#34;, &amp;#34;illuminate/pagination&amp;#34;: &amp;#34;^5.0&amp;#34; }, &amp;#34;repositories&amp;#34;: { &amp;#34;packagist&amp;#34;: { &amp;#34;type&amp;#34;: &amp;#34;composer&amp;#34;, &amp;#34;url&amp;#34;: &amp;#34;https://packagist.phpcomposer.com&amp;#34; //中国镜像站  } } }   这样 Eloquent 就安装好了。
配置    在项目入口文件加入
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  // 载入 composer 的 autoload 文件  require_once IA_ROOT .</description>
    </item>
    
    <item>
      <title>Laravel Eloquent 括号查询</title>
      <link>https://blog.adminchao.com/zh-cn/posts/laravel-eloquent-%E6%8B%AC%E5%8F%B7%E6%9F%A5%E8%AF%A2/</link>
      <pubDate>Fri, 08 Jun 2018 12:36:54 +0000</pubDate>
      
      <guid>https://blog.adminchao.com/zh-cn/posts/laravel-eloquent-%E6%8B%AC%E5%8F%B7%E6%9F%A5%E8%AF%A2/</guid>
      <description>相当于 select * from queue_second_sold where status=0 and (buy_user_id = 341 or (sell_user_id = 341 and buy_user_id != 0)) order by id desc,用法如下:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24  /** * 交易大厅-定向交易 * @param Request $request * @return \Illuminate\Http\JsonResponse */ public function soldList(Request $request){ $type = $request-&amp;gt;get(&amp;#39;type&amp;#39;,0); //交易大厅  $limit = $request-&amp;gt;get(&amp;#39;limit&amp;#39;,10); $user = User::getUserInfo(); if($type == 1){ //定向交易  $results = QueueSecondSold::where(&amp;#39;status&amp;#39;,0) -&amp;gt;where(function($query) use ($user){ $query-&amp;gt;where(&amp;#39;sell_user_id&amp;#39;,$user-&amp;gt;id) -&amp;gt;where(&amp;#39;buy_user_id&amp;#39;,&amp;#39;!</description>
    </item>
    
  </channel>
</rss>
