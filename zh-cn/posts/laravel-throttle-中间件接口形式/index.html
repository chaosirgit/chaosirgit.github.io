<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=color-scheme content="light dark">
<meta name=author content="郭超超">
<meta name=description content="前言    Laravel 自带请求频率限制中间件,但是这个中间件返回的并不是信息,在日常工作总可能需要以接口的形式返回
步骤    生成中间件文件    1  php artisan make:middleware ThrottleRequests   拷贝代码到 app\Http\Middleware\ThrottleRequests.php    1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197  <?">
<meta name=keywords content="Laravel,PHP,中间件,Throttle">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Laravel Throttle 中间件接口形式">
<meta name=twitter:description content="前言    Laravel 自带请求频率限制中间件,但是这个中间件返回的并不是信息,在日常工作总可能需要以接口的形式返回
步骤    生成中间件文件    1  php artisan make:middleware ThrottleRequests   拷贝代码到 app\Http\Middleware\ThrottleRequests.php    1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197  <?">
<meta property="og:title" content="Laravel Throttle 中间件接口形式">
<meta property="og:description" content="前言    Laravel 自带请求频率限制中间件,但是这个中间件返回的并不是信息,在日常工作总可能需要以接口的形式返回
步骤    生成中间件文件    1  php artisan make:middleware ThrottleRequests   拷贝代码到 app\Http\Middleware\ThrottleRequests.php    1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197  <?">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.adminchao.com/zh-cn/posts/laravel-throttle-%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%8E%A5%E5%8F%A3%E5%BD%A2%E5%BC%8F/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2019-07-25T18:33:53+00:00">
<meta property="article:modified_time" content="2019-07-25T18:33:53+00:00"><meta property="og:site_name" content="郭超超的博客">
<title>
Laravel Throttle 中间件接口形式 · 郭超超的博客
</title><link rel=canonical href=https://blog.adminchao.com/zh-cn/posts/laravel-throttle-%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%8E%A5%E5%8F%A3%E5%BD%A2%E5%BC%8F/>
<link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin>
<link rel=stylesheet href=/css/coder.min.d9fddbffe6f27e69985dc5fe0471cdb0e57fbf4775714bc3d847accb08f4a1f6.css integrity="sha256-2f3b/+byfmmYXcX+BHHNsOV/v0d1cUvD2Eesywj0ofY=" crossorigin=anonymous media=screen>
<link rel=stylesheet href=/css/coder-dark.min.002ee2378e14c7a68f1f0a53d9694ed252090987c4e768023fac694a4fc5f793.css integrity="sha256-AC7iN44Ux6aPHwpT2WlO0lIJCYfE52gCP6xpSk/F95M=" crossorigin=anonymous media=screen>
<link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16>
<link rel=apple-touch-icon href=/images/apple-touch-icon.png>
<link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png>
<meta name=generator content="Hugo 0.93.3">
</head><body class="preload-transitions colorscheme-dark">
<div class=float-container>
<a id=dark-mode-toggle class=colorscheme-toggle>
<i class="fa fa-adjust fa-fw" aria-hidden=true></i>
</a>
</div><main class=wrapper>
<nav class=navigation>
<section class=container>
<a class=navigation-title href=/zh-cn>
郭超超的博客
</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle>
<i class="fa fa-bars fa-fw" aria-hidden=true></i>
</label>
<ul class=navigation-list>
<li class=navigation-item>
<a class=navigation-link href=/zh-cn/about/>关于</a>
</li><li class=navigation-item>
<a class=navigation-link href=/zh-cn/posts/>博文</a>
</li><li class=navigation-item>
<a class=navigation-link href=/zh-cn/contact/>联系</a>
</li><li class="navigation-item menu-separator">
<span>|</span>
</li><li class=navigation-item>
<a href=https://blog.adminchao.com/>🇺🇸</a>
</li></ul></section></nav><div class=content>
<section class="container post">
<article>
<header>
<div class=post-title>
<h1 class=title>
<a class=title-link href=https://blog.adminchao.com/zh-cn/posts/laravel-throttle-%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%8E%A5%E5%8F%A3%E5%BD%A2%E5%BC%8F/>
Laravel Throttle 中间件接口形式
</a>
</h1></div><div class=post-meta>
<div class=date>
<span class=posted-on>
<i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2019-07-25T18:33:53Z>
2019-07-25 18:33:53
</time>
</span>
<span class=reading-time>
<i class="fa fa-clock-o" aria-hidden=true></i>
阅读时间：4 分钟
</span>
</div><div class=categories>
<i class="fa fa-folder" aria-hidden=true></i>
<a href=/zh-cn/categories/%E6%8A%80%E6%9C%AF/>技术</a></div><div class=tags>
<i class="fa fa-tag" aria-hidden=true></i>
<span class=tag>
<a href=/zh-cn/tags/laravel/>Laravel</a>
</span>
<span class=separator>•</span>
<span class=tag>
<a href=/zh-cn/tags/php/>PHP</a>
</span>
<span class=separator>•</span>
<span class=tag>
<a href=/zh-cn/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/>中间件</a>
</span></div></div></header><div>
<h2 id=前言>
前言
<a class=heading-link href=#%e5%89%8d%e8%a8%80>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2><p>Laravel 自带请求频率限制中间件,但是这个中间件返回的并不是信息,在日常工作总可能需要以接口的形式返回</p><h2 id=步骤>
步骤
<a class=heading-link href=#%e6%ad%a5%e9%aa%a4>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2><h3 id=生成中间件文件>
生成中间件文件
<a class=heading-link href=#%e7%94%9f%e6%88%90%e4%b8%ad%e9%97%b4%e4%bb%b6%e6%96%87%e4%bb%b6>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h3><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>php artisan make:middleware ThrottleRequests
</span></span></code></pre></td></tr></table></div></div><h3 id=拷贝代码到-apphttpmiddlewarethrottlerequestsphp>
拷贝代码到 <code>app\Http\Middleware\ThrottleRequests.php</code>
<a class=heading-link href=#%e6%8b%b7%e8%b4%9d%e4%bb%a3%e7%a0%81%e5%88%b0-apphttpmiddlewarethrottlerequestsphp>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h3><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">127
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">128
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">129
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">130
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">131
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">132
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">133
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">134
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">135
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">136
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">137
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">138
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">139
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">140
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">141
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">142
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">143
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">144
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">145
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">146
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">147
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">148
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">149
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">150
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">151
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">152
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">153
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">154
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">155
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">156
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">157
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">158
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">159
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">160
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">161
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">162
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">163
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">164
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">165
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">166
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">167
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">168
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">169
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">170
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">171
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">172
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">173
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">174
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">175
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">176
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">177
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">178
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">179
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">180
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">181
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">182
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">183
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">184
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">185
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">186
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">187
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">188
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">189
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">190
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">191
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">192
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">193
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">194
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">195
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">196
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">197
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#ff79c6>&lt;?</span>php
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>namespace</span> App\Http\Middleware;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>use</span> Closure;
</span></span><span style=display:flex><span><span style=color:#ff79c6>use</span> RuntimeException;
</span></span><span style=display:flex><span><span style=color:#ff79c6>use</span> Illuminate\Support\Str;
</span></span><span style=display:flex><span><span style=color:#ff79c6>use</span> Illuminate\Cache\RateLimiter;
</span></span><span style=display:flex><span><span style=color:#ff79c6>use</span> Illuminate\Support\InteractsWithTime;
</span></span><span style=display:flex><span><span style=color:#ff79c6>use</span> Symfony\Component\HttpFoundation\Response;
</span></span><span style=display:flex><span><span style=color:#ff79c6>use</span> Symfony\Component\HttpKernel\Exception\HttpException;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>ThrottleRequests</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>use</span> InteractsWithTime;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>/**
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * The rate limiter instance.
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     *
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @var \Illuminate\Cache\RateLimiter
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>protected</span> <span style=color:#8be9fd;font-style:italic>$limiter</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>/**
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * Create a new request throttler.
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     *
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @param  \Illuminate\Cache\RateLimiter  $limiter
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @return void
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>public</span> <span style=color:#ff79c6>function</span> __construct(RateLimiter <span style=color:#8be9fd;font-style:italic>$limiter</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>limiter</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$limiter</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>/**
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * Handle an incoming request.
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     *
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @param  \Illuminate\Http\Request  $request
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @param  \Closure  $next
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @param  int|string  $maxAttempts
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @param  float|int  $decayMinutes
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @return mixed
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @throws \Symfony\Component\HttpKernel\Exception\HttpException
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>public</span> <span style=color:#ff79c6>function</span> <span style=color:#50fa7b>handle</span>(<span style=color:#8be9fd;font-style:italic>$request</span>, Closure <span style=color:#8be9fd;font-style:italic>$next</span>, <span style=color:#8be9fd;font-style:italic>$maxAttempts</span> <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>60</span>, <span style=color:#8be9fd;font-style:italic>$decayMinutes</span> <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>$key</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>resolveRequestSignature</span>(<span style=color:#8be9fd;font-style:italic>$request</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>$maxAttempts</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>resolveMaxAttempts</span>(<span style=color:#8be9fd;font-style:italic>$request</span>, <span style=color:#8be9fd;font-style:italic>$maxAttempts</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (<span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>limiter</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>tooManyAttempts</span>(<span style=color:#8be9fd;font-style:italic>$key</span>, <span style=color:#8be9fd;font-style:italic>$maxAttempts</span>, <span style=color:#8be9fd;font-style:italic>$decayMinutes</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span>(<span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>buildException</span>(<span style=color:#8be9fd;font-style:italic>$key</span>, <span style=color:#8be9fd;font-style:italic>$maxAttempts</span>)){
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>return</span> response()<span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>json</span>([<span style=color:#f1fa8c>&#39;code&#39;</span><span style=color:#ff79c6>=&gt;</span><span style=color:#bd93f9>429</span>,<span style=color:#f1fa8c>&#39;data&#39;</span><span style=color:#ff79c6>=&gt;</span><span style=color:#f1fa8c>&#39;请求太频繁了&#39;</span>]);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>limiter</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>hit</span>(<span style=color:#8be9fd;font-style:italic>$key</span>, <span style=color:#8be9fd;font-style:italic>$decayMinutes</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>$response</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$next</span>(<span style=color:#8be9fd;font-style:italic>$request</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>addHeaders</span>(
</span></span><span style=display:flex><span>            <span style=color:#8be9fd;font-style:italic>$response</span>, <span style=color:#8be9fd;font-style:italic>$maxAttempts</span>,
</span></span><span style=display:flex><span>            <span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>calculateRemainingAttempts</span>(<span style=color:#8be9fd;font-style:italic>$key</span>, <span style=color:#8be9fd;font-style:italic>$maxAttempts</span>)
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>/**
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * Resolve the number of attempts if the user is authenticated or not.
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     *
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @param  \Illuminate\Http\Request  $request
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @param  int|string  $maxAttempts
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @return int
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>protected</span> <span style=color:#ff79c6>function</span> <span style=color:#50fa7b>resolveMaxAttempts</span>(<span style=color:#8be9fd;font-style:italic>$request</span>, <span style=color:#8be9fd;font-style:italic>$maxAttempts</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (Str<span style=color:#ff79c6>::</span><span style=color:#50fa7b>contains</span>(<span style=color:#8be9fd;font-style:italic>$maxAttempts</span>, <span style=color:#f1fa8c>&#39;|&#39;</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#8be9fd;font-style:italic>$maxAttempts</span> <span style=color:#ff79c6>=</span> explode(<span style=color:#f1fa8c>&#39;|&#39;</span>, <span style=color:#8be9fd;font-style:italic>$maxAttempts</span>, <span style=color:#bd93f9>2</span>)[<span style=color:#8be9fd;font-style:italic>$request</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>user</span>() <span style=color:#ff79c6>?</span> <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>:</span> <span style=color:#bd93f9>0</span>];
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> (int) <span style=color:#8be9fd;font-style:italic>$maxAttempts</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>/**
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * Resolve request signature.
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     *
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @param  \Illuminate\Http\Request  $request
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @return string
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @throws \RuntimeException
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>protected</span> <span style=color:#ff79c6>function</span> <span style=color:#50fa7b>resolveRequestSignature</span>(<span style=color:#8be9fd;font-style:italic>$request</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (<span style=color:#8be9fd;font-style:italic>$user</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$request</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>user</span>()) {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span> sha1(<span style=color:#8be9fd;font-style:italic>$user</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>getAuthIdentifier</span>());
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (<span style=color:#8be9fd;font-style:italic>$route</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$request</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>route</span>()) {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span> sha1(<span style=color:#8be9fd;font-style:italic>$route</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>getDomain</span>()<span style=color:#ff79c6>.</span><span style=color:#f1fa8c>&#39;|&#39;</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd;font-style:italic>$request</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>ip</span>());
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>throw</span> <span style=color:#ff79c6>new</span> RuntimeException(
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#39;Unable to generate the request signature. Route unavailable.&#39;</span>
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>/**
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * Create a &#39;too many attempts&#39; exception.
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     *
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @param  string  $key
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @param  int  $maxAttempts
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @return \Symfony\Component\HttpKernel\Exception\HttpException
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>protected</span> <span style=color:#ff79c6>function</span> <span style=color:#50fa7b>buildException</span>(<span style=color:#8be9fd;font-style:italic>$key</span>, <span style=color:#8be9fd;font-style:italic>$maxAttempts</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>$retryAfter</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>getTimeUntilNextRetry</span>(<span style=color:#8be9fd;font-style:italic>$key</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>$headers</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>getHeaders</span>(
</span></span><span style=display:flex><span>            <span style=color:#8be9fd;font-style:italic>$maxAttempts</span>,
</span></span><span style=display:flex><span>            <span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>calculateRemainingAttempts</span>(<span style=color:#8be9fd;font-style:italic>$key</span>, <span style=color:#8be9fd;font-style:italic>$maxAttempts</span>, <span style=color:#8be9fd;font-style:italic>$retryAfter</span>),
</span></span><span style=display:flex><span>            <span style=color:#8be9fd;font-style:italic>$retryAfter</span>
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>//        return new HttpException(
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//            429, &#39;Too Many Attempts.&#39;, null, $headers
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//        );
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>/**
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * Get the number of seconds until the next retry.
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     *
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @param  string  $key
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @return int
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>protected</span> <span style=color:#ff79c6>function</span> <span style=color:#50fa7b>getTimeUntilNextRetry</span>(<span style=color:#8be9fd;font-style:italic>$key</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>limiter</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>availableIn</span>(<span style=color:#8be9fd;font-style:italic>$key</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>/**
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * Add the limit header information to the given response.
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     *
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @param  \Symfony\Component\HttpFoundation\Response  $response
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @param  int  $maxAttempts
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @param  int  $remainingAttempts
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @param  int|null  $retryAfter
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @return \Symfony\Component\HttpFoundation\Response
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>protected</span> <span style=color:#ff79c6>function</span> <span style=color:#50fa7b>addHeaders</span>(Response <span style=color:#8be9fd;font-style:italic>$response</span>, <span style=color:#8be9fd;font-style:italic>$maxAttempts</span>, <span style=color:#8be9fd;font-style:italic>$remainingAttempts</span>, <span style=color:#8be9fd;font-style:italic>$retryAfter</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>null</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>$response</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>headers</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>add</span>(
</span></span><span style=display:flex><span>            <span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>getHeaders</span>(<span style=color:#8be9fd;font-style:italic>$maxAttempts</span>, <span style=color:#8be9fd;font-style:italic>$remainingAttempts</span>, <span style=color:#8be9fd;font-style:italic>$retryAfter</span>)
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>$response</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>/**
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * Get the limit headers information.
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     *
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @param  int  $maxAttempts
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @param  int  $remainingAttempts
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @param  int|null  $retryAfter
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @return array
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>protected</span> <span style=color:#ff79c6>function</span> <span style=color:#50fa7b>getHeaders</span>(<span style=color:#8be9fd;font-style:italic>$maxAttempts</span>, <span style=color:#8be9fd;font-style:italic>$remainingAttempts</span>, <span style=color:#8be9fd;font-style:italic>$retryAfter</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>null</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>$headers</span> <span style=color:#ff79c6>=</span> [
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#39;X-RateLimit-Limit&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$maxAttempts</span>,
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#39;X-RateLimit-Remaining&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$remainingAttempts</span>,
</span></span><span style=display:flex><span>        ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span> is_null(<span style=color:#8be9fd;font-style:italic>$retryAfter</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#8be9fd;font-style:italic>$headers</span>[<span style=color:#f1fa8c>&#39;Retry-After&#39;</span>] <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$retryAfter</span>;
</span></span><span style=display:flex><span>            <span style=color:#8be9fd;font-style:italic>$headers</span>[<span style=color:#f1fa8c>&#39;X-RateLimit-Reset&#39;</span>] <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>availableAt</span>(<span style=color:#8be9fd;font-style:italic>$retryAfter</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>$headers</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>/**
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * Calculate the number of remaining attempts.
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     *
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @param  string  $key
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @param  int  $maxAttempts
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @param  int|null  $retryAfter
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     * @return int
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>protected</span> <span style=color:#ff79c6>function</span> <span style=color:#50fa7b>calculateRemainingAttempts</span>(<span style=color:#8be9fd;font-style:italic>$key</span>, <span style=color:#8be9fd;font-style:italic>$maxAttempts</span>, <span style=color:#8be9fd;font-style:italic>$retryAfter</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>null</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (is_null(<span style=color:#8be9fd;font-style:italic>$retryAfter</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>limiter</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>retriesLeft</span>(<span style=color:#8be9fd;font-style:italic>$key</span>, <span style=color:#8be9fd;font-style:italic>$maxAttempts</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=打开-apphttpkernelphp-在-routemiddleware-数组下添加如下>
打开 <code>app\Http\Kernel.php</code> 在 <code>$routeMiddleware</code> 数组下添加如下
<a class=heading-link href=#%e6%89%93%e5%bc%80-apphttpkernelphp-%e5%9c%a8-routemiddleware-%e6%95%b0%e7%bb%84%e4%b8%8b%e6%b7%bb%e5%8a%a0%e5%a6%82%e4%b8%8b>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h3><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f1fa8c>&#39;throttle&#39;</span> <span style=color:#ff79c6>=&gt;</span> \App\Http\Middleware\ThrottleRequests<span style=color:#ff79c6>::</span><span style=color:#50fa7b>class</span>,
</span></span></code></pre></td></tr></table></div></div><h2 id=使用>
使用
<a class=heading-link href=#%e4%bd%bf%e7%94%a8>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2><p>路由中使用</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>    Route<span style=color:#ff79c6>::</span><span style=color:#50fa7b>post</span>(<span style=color:#f1fa8c>&#39;api/test&#39;</span>,[<span style=color:#f1fa8c>&#39;uses&#39;</span><span style=color:#ff79c6>=&gt;</span><span style=color:#f1fa8c>&#39;TestController@test&#39;</span>,<span style=color:#f1fa8c>&#39;middleware&#39;</span><span style=color:#ff79c6>=&gt;</span>[<span style=color:#f1fa8c>&#39;throttle:1&#39;</span>]]);
</span></span></code></pre></td></tr></table></div></div></div><footer>
</footer></article></section></div><footer class=footer>
<section class=container>
©
2019 -
2022
郭超超
·
技术支持 <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.
</section></footer></main><script src=/js/coder.min.8fb86376a16e684af472a329aef502dbebcfab65ce264e9750d144912947c602.js integrity="sha256-j7hjdqFuaEr0cqMprvUC2+vPq2XOJk6XUNFEkSlHxgI="></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NK08XEDHKZ"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-NK08XEDHKZ")</script>
</body></html>