<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=color-scheme content="light dark">
<meta name=author content="郭超超">
<meta name=description content="前言    在项目中需要以编程方式后台执行脚本，以官方 Artisan::call() 调用的话，如果脚本时间过长，会进程中断，导致脚本执行不成功，所以需要后台挂起执行。
Artisan 命令行工具    请参照官方文档
以编程方式调用    1 2 3 4 5  <?php  use Illuminate\Support\Facades\Artisan;  Artisan::call('command',['id'=>1]);   这里注意，如果在代码有事务，Artisan::call() 需要在 commit 或 rollback 后调用。
后台调用    直接上代码
1 2 3 4 5 6 7  <?php use Symfony\Component\Process\Process;  $process = new Process('nohup php artisan command '.$id .' >/var/www/html/crowd/nohup.log 2>&1 &','path/to/artisan'); //第一个参数是运行的命令,命令方式跟 Linux 一致，第二个参数是可以执行此条命令的路径  $process->start();  ?">
<meta name=keywords content="Laravel,Artisan,后台,命令行">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Laravel Artisan 后台调用">
<meta name=twitter:description content="前言    在项目中需要以编程方式后台执行脚本，以官方 Artisan::call() 调用的话，如果脚本时间过长，会进程中断，导致脚本执行不成功，所以需要后台挂起执行。
Artisan 命令行工具    请参照官方文档
以编程方式调用    1 2 3 4 5  <?php  use Illuminate\Support\Facades\Artisan;  Artisan::call('command',['id'=>1]);   这里注意，如果在代码有事务，Artisan::call() 需要在 commit 或 rollback 后调用。
后台调用    直接上代码
1 2 3 4 5 6 7  <?php use Symfony\Component\Process\Process;  $process = new Process('nohup php artisan command '.$id .' >/var/www/html/crowd/nohup.log 2>&1 &','path/to/artisan'); //第一个参数是运行的命令,命令方式跟 Linux 一致，第二个参数是可以执行此条命令的路径  $process->start();  ?">
<meta property="og:title" content="Laravel Artisan 后台调用">
<meta property="og:description" content="前言    在项目中需要以编程方式后台执行脚本，以官方 Artisan::call() 调用的话，如果脚本时间过长，会进程中断，导致脚本执行不成功，所以需要后台挂起执行。
Artisan 命令行工具    请参照官方文档
以编程方式调用    1 2 3 4 5  <?php  use Illuminate\Support\Facades\Artisan;  Artisan::call('command',['id'=>1]);   这里注意，如果在代码有事务，Artisan::call() 需要在 commit 或 rollback 后调用。
后台调用    直接上代码
1 2 3 4 5 6 7  <?php use Symfony\Component\Process\Process;  $process = new Process('nohup php artisan command '.$id .' >/var/www/html/crowd/nohup.log 2>&1 &','path/to/artisan'); //第一个参数是运行的命令,命令方式跟 Linux 一致，第二个参数是可以执行此条命令的路径  $process->start();  ?">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.adminchao.com/zh-cn/posts/laravel-artisan-%E5%90%8E%E5%8F%B0%E8%B0%83%E7%94%A8/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2018-10-15T10:04:39+00:00">
<meta property="article:modified_time" content="2018-10-15T10:04:39+00:00"><meta property="og:site_name" content="郭超超的博客">
<title>
Laravel Artisan 后台调用 · 郭超超的博客
</title><link rel=canonical href=https://blog.adminchao.com/zh-cn/posts/laravel-artisan-%E5%90%8E%E5%8F%B0%E8%B0%83%E7%94%A8/>
<link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin>
<link rel=stylesheet href=/css/coder.min.d9fddbffe6f27e69985dc5fe0471cdb0e57fbf4775714bc3d847accb08f4a1f6.css integrity="sha256-2f3b/+byfmmYXcX+BHHNsOV/v0d1cUvD2Eesywj0ofY=" crossorigin=anonymous media=screen>
<link rel=stylesheet href=/css/coder-dark.min.002ee2378e14c7a68f1f0a53d9694ed252090987c4e768023fac694a4fc5f793.css integrity="sha256-AC7iN44Ux6aPHwpT2WlO0lIJCYfE52gCP6xpSk/F95M=" crossorigin=anonymous media=screen>
<link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16>
<link rel=apple-touch-icon href=/images/apple-touch-icon.png>
<link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png>
<meta name=generator content="Hugo 0.93.3">
</head><body class="preload-transitions colorscheme-dark">
<div class=float-container>
<a id=dark-mode-toggle class=colorscheme-toggle>
<i class="fa fa-adjust fa-fw" aria-hidden=true></i>
</a>
</div><main class=wrapper>
<nav class=navigation>
<section class=container>
<a class=navigation-title href=/zh-cn>
郭超超的博客
</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle>
<i class="fa fa-bars fa-fw" aria-hidden=true></i>
</label>
<ul class=navigation-list>
<li class=navigation-item>
<a class=navigation-link href=/zh-cn/about/>关于</a>
</li><li class=navigation-item>
<a class=navigation-link href=/zh-cn/posts/>博文</a>
</li><li class=navigation-item>
<a class=navigation-link href=/zh-cn/contact/>联系</a>
</li><li class="navigation-item menu-separator">
<span>|</span>
</li><li class=navigation-item>
<a href=https://blog.adminchao.com/>🇺🇸</a>
</li></ul></section></nav><div class=content>
<section class="container post">
<article>
<header>
<div class=post-title>
<h1 class=title>
<a class=title-link href=https://blog.adminchao.com/zh-cn/posts/laravel-artisan-%E5%90%8E%E5%8F%B0%E8%B0%83%E7%94%A8/>
Laravel Artisan 后台调用
</a>
</h1></div><div class=post-meta>
<div class=date>
<span class=posted-on>
<i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2018-10-15T10:04:39Z>
2018-10-15 10:04:39
</time>
</span>
<span class=reading-time>
<i class="fa fa-clock-o" aria-hidden=true></i>
阅读时间：1 分钟
</span>
</div><div class=categories>
<i class="fa fa-folder" aria-hidden=true></i>
<a href=/zh-cn/categories/%E6%8A%80%E6%9C%AF/>技术</a></div><div class=tags>
<i class="fa fa-tag" aria-hidden=true></i>
<span class=tag>
<a href=/zh-cn/tags/laravel/>Laravel</a>
</span>
<span class=separator>•</span>
<span class=tag>
<a href=/zh-cn/tags/artisan/>Artisan</a>
</span>
<span class=separator>•</span>
<span class=tag>
<a href=/zh-cn/tags/%E5%90%8E%E5%8F%B0/>后台</a>
</span>
<span class=separator>•</span>
<span class=tag>
<a href=/zh-cn/tags/%E5%91%BD%E4%BB%A4%E8%A1%8C/>命令行</a>
</span></div></div></header><div>
<h2 id=前言>
前言
<a class=heading-link href=#%e5%89%8d%e8%a8%80>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2><p>在项目中需要以编程方式后台执行脚本，以官方 <code>Artisan::call()</code> 调用的话，如果脚本时间过长，会进程中断，导致脚本执行不成功，所以需要后台挂起执行。</p><h2 id=artisan-命令行工具>
Artisan 命令行工具
<a class=heading-link href=#artisan-%e5%91%bd%e4%bb%a4%e8%a1%8c%e5%b7%a5%e5%85%b7>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2><p>请参照官方文档</p><h2 id=以编程方式调用>
以编程方式调用
<a class=heading-link href=#%e4%bb%a5%e7%bc%96%e7%a8%8b%e6%96%b9%e5%bc%8f%e8%b0%83%e7%94%a8>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#ff79c6>&lt;?</span>php
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>use</span> Illuminate\Support\Facades\Artisan;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Artisan<span style=color:#ff79c6>::</span><span style=color:#50fa7b>call</span>(<span style=color:#f1fa8c>&#39;command&#39;</span>,[<span style=color:#f1fa8c>&#39;id&#39;</span><span style=color:#ff79c6>=&gt;</span><span style=color:#bd93f9>1</span>]);
</span></span></code></pre></td></tr></table></div></div><p>这里注意，如果在代码有事务，<code>Artisan::call()</code> 需要在 <code>commit</code> 或 <code>rollback</code> 后调用。</p><h2 id=后台调用>
后台调用
<a class=heading-link href=#%e5%90%8e%e5%8f%b0%e8%b0%83%e7%94%a8>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2><p>直接上代码</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#ff79c6>&lt;?</span>php
</span></span><span style=display:flex><span><span style=color:#ff79c6>use</span> Symfony\Component\Process\Process;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$process</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> Process(<span style=color:#f1fa8c>&#39;nohup php artisan command &#39;</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd;font-style:italic>$id</span> <span style=color:#ff79c6>.</span><span style=color:#f1fa8c>&#39; &gt;/var/www/html/crowd/nohup.log 2&gt;&amp;1 &amp;&#39;</span>,<span style=color:#f1fa8c>&#39;path/to/artisan&#39;</span>); <span style=color:#6272a4>//第一个参数是运行的命令,命令方式跟 Linux 一致，第二个参数是可以执行此条命令的路径
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>            <span style=color:#8be9fd;font-style:italic>$process</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>start</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>?&gt;</span>
</span></span></code></pre></td></tr></table></div></div></div><footer>
</footer></article></section></div><footer class=footer>
<section class=container>
©
2019 -
2022
郭超超
·
技术支持 <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.
</section></footer></main><script src=/js/coder.min.8fb86376a16e684af472a329aef502dbebcfab65ce264e9750d144912947c602.js integrity="sha256-j7hjdqFuaEr0cqMprvUC2+vPq2XOJk6XUNFEkSlHxgI="></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NK08XEDHKZ"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-NK08XEDHKZ")</script>
</body></html>